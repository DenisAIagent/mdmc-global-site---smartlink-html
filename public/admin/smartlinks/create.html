<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er SmartLink</title>
    <style>
        :root {
            --primary: #E50914;
            --secondary: #141414;
            --white: #FFFFFF;
            --gray-light: #F8F9FA;
            --gray-medium: #999999;
            --shadow-light: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-medium: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-heavy: 0 8px 32px rgba(0,0,0,0.12);
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-light);
            color: var(--secondary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .page-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 32px 20px;
        }

        /* HEADER */
        .header-nav {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 48px;
            padding: 20px 32px;
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--gray-medium);
            font-weight: 500;
            transition: var(--transition);
            padding: 8px 16px;
            border-radius: var(--border-radius);
        }

        .back-button:hover {
            color: var(--primary);
            background: rgba(229, 9, 20, 0.05);
        }

        .logo-badge {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--secondary);
        }

        /* MAIN CONTENT */
        .main-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .main-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 12px;
        }

        .main-header p {
            font-size: 16px;
            color: var(--gray-medium);
            max-width: 600px;
            margin: 0 auto;
        }

        /* FORM SECTIONS */
        .form-section {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: 40px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .section-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
        }

        .form-description {
            font-size: 14px;
            color: var(--gray-medium);
            margin-bottom: 16px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
        }

        .form-input::placeholder {
            color: var(--gray-medium);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* BUTTONS */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #cc0812;
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--secondary);
            border: 1px solid rgba(0,0,0,0.08);
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-block {
            width: 100%;
        }

        .btn-center {
            margin: 0 auto;
            display: block;
        }

        /* INFO BOX */
        .info-box {
            background: rgba(229, 9, 20, 0.05);
            border: 1px solid rgba(229, 9, 20, 0.1);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .info-box p {
            color: var(--secondary);
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* PLATFORM GRID */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .platform-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border: 1px solid rgba(0,0,0,0.06);
            border-radius: var(--border-radius);
            background: var(--gray-light);
            transition: var(--transition);
        }

        .platform-item:hover {
            border-color: var(--primary);
            background: rgba(229, 9, 20, 0.02);
        }

        .platform-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .platform-icon svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .spotify { background: #1DB954; }
        .apple-music { background: linear-gradient(45deg, #FA233B, #FF6B35); }
        .youtube-music { background: #FF0000; }
        .deezer { background: #FF9500; }
        .tidal { background: #000000; }
        .amazon-music { background: #00A8E1; }
        .soundcloud { background: #FF5500; }

        .platform-name {
            font-weight: 500;
            color: var(--secondary);
        }

        /* PROGRESS STEPS */
        .progress-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 48px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step:not(:last-child)::after {
            content: '';
            width: 40px;
            height: 2px;
            background: var(--gray-light);
            margin-left: 12px;
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gray-light);
            color: var(--gray-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .step.active .step-number {
            background: var(--primary);
            color: white;
        }

        .step.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step-label {
            font-size: 14px;
            color: var(--gray-medium);
            font-weight: 500;
        }

        .step.active .step-label {
            color: var(--primary);
        }

        /* GENERATED RESULT */
        .result-card {
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.05), rgba(229, 9, 20, 0.02));
            border: 1px solid rgba(229, 9, 20, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            text-align: center;
            margin: 32px 0;
        }

        .result-url {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            background: var(--white);
            padding: 16px 24px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(229, 9, 20, 0.2);
            margin: 20px 0;
            word-break: break-all;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 32px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .page-container {
                padding: 20px 16px;
            }

            .form-section {
                padding: 24px;
            }

            .main-header h1 {
                font-size: 24px;
            }

            .platform-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .progress-steps {
                overflow-x: auto;
                padding-bottom: 16px;
            }
        }

        /* ANIMATIONS */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            animation: slideInUp 0.6s ease-out;
            animation-fill-mode: both;
        }

        .form-section:nth-child(2) { animation-delay: 0.1s; }
        .form-section:nth-child(3) { animation-delay: 0.2s; }
        .form-section:nth-child(4) { animation-delay: 0.3s; }

        /* AUDIO UPLOAD STYLES */
        .audio-upload-container {
            position: relative;
        }

        .audio-input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .upload-zone {
            border: 2px dashed rgba(0,0,0,0.08);
            border-radius: var(--border-radius);
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-zone:hover {
            border-color: var(--primary);
            background: rgba(229, 9, 20, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--primary);
            background: rgba(229, 9, 20, 0.1);
        }

        .upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--secondary);
        }

        .upload-zone small {
            color: var(--gray-medium);
            font-size: 12px;
        }

        .upload-progress {
            padding: 16px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 14px;
            color: var(--gray-medium);
        }

        .upload-success {
            padding: 16px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .success-icon {
            font-size: 20px;
        }

        .success-text {
            flex: 1;
            font-weight: 500;
            color: #10b981;
        }

        .remove-audio {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .remove-audio:hover {
            background: rgba(220, 38, 38, 0.1);
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- HEADER NAVIGATION -->
        <nav class="header-nav">
            <a href="#" class="back-button" onclick="goBack()">
                <span>‚Üê</span>
                <span>Retour</span>
            </a>
            <div class="logo-badge">M</div>
            <span class="page-title">Cr√©er SmartLink</span>
        </nav>

        <!-- MAIN HEADER -->
        <header class="main-header">
            <h1>Cr√©er un nouveau SmartLink</h1>
            <p>G√©n√©rez un lien intelligent pour partager votre musique sur toutes les plateformes</p>
        </header>

        <!-- PROGRESS STEPS -->
        <div class="progress-steps">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-label">Source</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-label">Personnalisation</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-label">G√©n√©ration</div>
            </div>
        </div>

        <!-- FORM SECTIONS -->
        <form id="smartlinkForm">
            <!-- SECTION 1: SOURCE -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <h2 class="section-title">Source de la musique</h2>
                </div>

                <div class="form-group">
                    <label class="form-label">URL source (Spotify, Deezer, Apple Music...)</label>
                    <p class="form-description">Collez l'URL de votre titre, album ou playlist depuis n'importe quelle plateforme musicale</p>
                    <input 
                        type="url" 
                        class="form-input" 
                        id="sourceUrl" 
                        placeholder="https://open.spotify.com/track/..."
                        required
                    >
                </div>

                <div class="info-box">
                    <p>Saisissez une URL de plateforme musicale pour r√©cup√©rer automatiquement les m√©tadonn√©es et liens</p>
                    <button type="button" class="btn btn-primary" onclick="fetchMetadata()">
                        <span>üîç</span>
                        R√©cup√©rer les informations
                    </button>
                </div>

                <div class="platform-grid">
                    <div class="platform-item">
                        <div class="platform-icon spotify">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.32 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"/>
                            </svg>
                        </div>
                        <div class="platform-name">Spotify</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon apple-music">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M23.997 6.124c0-.738-.065-1.47-.24-2.19-.317-1.31-1.062-2.31-2.18-3.043C21.003.517 20.373.285 19.7.164c-.517-.093-1.038-.135-1.564-.14-.04-.003-.083-.01-.124-.013H5.988c-.152.01-.303.017-.455.034-.297.034-.591.076-.879.146-.773.189-1.455.543-2.01 1.138-.474.508-.8 1.1-.97 1.764-.134.52-.2 1.052-.2 1.582v11.777c0 .535.066 1.067.2 1.582.17.664.496 1.256.97 1.764.555.595 1.237.95 2.01 1.138.288.07.582.112.879.146.152.017.303.024.455.034h11.964c.152-.01.303-.017.455-.034.297-.034.591-.076.879-.146.773-.188 1.455-.543 2.01-1.138.474-.508.8-1.1.97-1.764.175-.72.24-1.452.24-2.19V6.124zm-11.455 6.778c-.24 0-.24-.034-.24-.273V6.124c0-.239 0-.273.24-.273.034 0 .068 0 .102.007.273.034.477.24.51.51.034.034.034.068.034.102v6.137c0 .239 0 .273-.24.273-.034 0-.068 0-.102-.007-.273-.034-.477-.24-.51-.51-.034-.034-.034-.068-.034-.102z"/>
                            </svg>
                        </div>
                        <div class="platform-name">Apple Music</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon youtube-music">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm5.568 16.176c-.54.54-1.368.864-2.208.864H8.64c-.84 0-1.68-.324-2.208-.864C5.904 15.648 5.58 14.82 5.58 13.98V10.02c0-.84.324-1.68.864-2.208C6.972 7.284 7.8 6.96 8.64 6.96h6.72c.84 0 1.668.324 2.208.864.528.528.852 1.368.852 2.208v3.96c0 .84-.324 1.668-.852 2.184zM9.84 10.8v2.4L13.2 12l-3.36-1.2z"/>
                            </svg>
                        </div>
                        <div class="platform-name">YouTube Music</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon deezer">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.81 6.75h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm-6.48-7.2h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm0 1.8h4.44v.9h-4.44zm-6.48-9h4.44v.9H5.85zm0 1.8h4.44v.9H5.85zm0 1.8h4.44v.9H5.85zm0 1.8h4.44v.9H5.85zm0 1.8h4.44v.9H5.85zm0 1.8h4.44v.9H5.85zm0 1.8h4.44v.9H5.85z"/>
                            </svg>
                        </div>
                        <div class="platform-name">Deezer</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon tidal">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0L8 4l4 4 4-4-4-4zM0 8l4-4 4 4-4 4-4-4zm16 0l4-4 4 4-4 4-4-4zM8 16l4-4 4 4-4 4-4-4z"/>
                            </svg>
                        </div>
                        <div class="platform-name">Tidal</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon amazon-music">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm7.753 17.624c-.301.301-.784.301-1.085 0-.301-.301-.301-.784 0-1.085 2.796-2.796 2.796-7.354 0-10.15-.301-.301-.301-.784 0-1.085.301-.301.784-.301 1.085 0 3.398 3.398 3.398 8.922 0 12.32zM16.5 15.364c-.301.301-.784.301-1.085 0-.301-.301-.301-.784 0-1.085 1.359-1.359 1.359-3.566 0-4.925-.301-.301-.301-.784 0-1.085.301-.301.784-.301 1.085 0 1.961 1.961 1.961 5.134 0 7.095z"/>
                            </svg>
                        </div>
                        <div class="platform-name">Amazon Music</div>
                    </div>
                    <div class="platform-item">
                        <div class="platform-icon soundcloud">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.104.101.104.058 0 .104-.046.111-.104l.294-2.105-.294-2.154c-.007-.054-.053-.1-.111-.1zm1.294.058c-.089 0-.163.073-.177.165l-.255 2.096.255 2.262c.014.092.088.165.177.165s.163-.073.177-.165l.316-2.262-.316-2.096c-.014-.092-.088-.165-.177-.165z"/>
                            </svg>
                        </div>
                        <div class="platform-name">SoundCloud</div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: PERSONNALISATION -->
            <div class="form-section" id="customSection" style="display: none;">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <h2 class="section-title">Personnalisation</h2>
                </div>

                <!-- Pr√©visualisation des donn√©es r√©cup√©r√©es -->
                <div id="metadataPreview" style="display: none; background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <img id="previewArtwork" src="" alt="Artwork" style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover;">
                        <div>
                            <h4 id="previewTitle" style="margin: 0 0 4px 0; font-size: 16px; font-weight: 600;"></h4>
                            <p id="previewArtist" style="margin: 0 0 8px 0; color: #666; font-size: 14px;"></p>
                            <div id="previewPlatforms" style="font-size: 12px; color: #10b981; font-weight: 500;"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Titre du SmartLink</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="smartlinkTitle" 
                        placeholder="Mon Nouveau Single 2025"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Nom de l'artiste</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="artistName" 
                        placeholder="Nom de l'artiste"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">URL de l'artwork</label>
                    <input 
                        type="url" 
                        class="form-input" 
                        id="artworkUrl" 
                        placeholder="https://exemple.com/artwork.jpg"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Extrait audio (30 secondes max)</label>
                    <div class="audio-upload-container">
                        <input type="file" id="audioFile" name="audioFile" 
                               accept="audio/*" class="audio-input">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">üéµ</div>
                            <p class="upload-text">Cliquez ou glissez votre extrait audio</p>
                            <small>MP3, WAV, M4A - 10MB max</small>
                        </div>
                        <div class="upload-progress" id="uploadProgress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <span class="progress-text" id="progressText">Upload en cours...</span>
                            <button type="button" id="cancelUploadBtn" class="btn btn-secondary" style="margin-top: 12px; padding: 8px 16px; font-size: 12px; display: none;" onclick="cancelUpload()">
                                ‚ùå Annuler et continuer sans audio
                            </button>
                        </div>
                        <div class="upload-success" id="uploadSuccess" style="display: none;">
                            <div class="success-icon">‚úÖ</div>
                            <span class="success-text" id="successText">Extrait upload√©</span>
                            <button type="button" class="remove-audio" id="removeAudio">‚ùå</button>
                        </div>
                    </div>
                    <input type="hidden" id="previewUrl" name="previewUrl">
                </div>

                <div class="form-group">
                    <label class="form-label">Description (optionnelle)</label>
                    <textarea 
                        class="form-input form-textarea" 
                        id="smartlinkDescription" 
                        placeholder="Ajoutez une description pour vos fans..."
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">URL personnalis√©e (optionnelle)</label>
                    <p class="form-description">Laissez vide pour g√©n√©rer automatiquement</p>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="customSlug" 
                        placeholder="mon-single-2025"
                    >
                </div>
            </div>

            <!-- SECTION 3: R√âSULTAT -->
            <div class="form-section" id="resultSection" style="display: none;">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <h2 class="section-title">Votre SmartLink est pr√™t !</h2>
                </div>

                <div class="result-card">
                    <h3 style="margin-bottom: 16px; color: var(--secondary);">üéâ SmartLink g√©n√©r√© avec succ√®s</h3>
                    <div class="result-url" id="generatedUrl">
                        <!-- URL sera g√©n√©r√©e dynamiquement -->
                    </div>
                    <p style="color: var(--gray-medium); margin-top: 16px;">
                        Partagez ce lien partout ! Vos fans seront automatiquement redirig√©s vers leur plateforme pr√©f√©r√©e.
                    </p>
                    <p style="color: var(--gray-medium); font-size: 14px; margin-top: 8px;">
                        Format: https://www.mdmcmusicads.com/sl/shortId.html
                    </p>
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="action-buttons">
                <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;" onclick="previousStep()">
                    <span>‚Üê</span>
                    Pr√©c√©dent
                </button>
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    Continuer
                    <span>‚Üí</span>
                </button>
                <button type="button" class="btn btn-primary btn-block" id="createBtn" style="display: none;" onclick="createSmartLink()">
                    <span>üöÄ</span>
                    Cr√©er le SmartLink
                </button>
                <button type="button" class="btn btn-primary" id="copyBtn" style="display: none;" onclick="copyToClipboard()">
                    <span>üìã</span>
                    Copier le lien
                </button>
                <button type="button" class="btn btn-secondary" id="shareBtn" style="display: none;" onclick="shareSmartLink()">
                    <span>üì§</span>
                    Partager
                </button>
            </div>
        </form>
    </div>

    <script>
        let currentStep = 1;
        let fetchedMetadata = null;

        function updateSteps() {
            const steps = document.querySelectorAll('.step');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const createBtn = document.getElementById('createBtn');
            const copyBtn = document.getElementById('copyBtn');
            const shareBtn = document.getElementById('shareBtn');

            // Update step indicators
            steps.forEach((step, index) => {
                const stepNumber = index + 1;
                step.classList.toggle('active', stepNumber === currentStep);
                step.classList.toggle('completed', stepNumber < currentStep);
            });

            // Show/hide sections
            document.getElementById('customSection').style.display = currentStep >= 2 ? 'block' : 'none';
            document.getElementById('resultSection').style.display = currentStep >= 3 ? 'block' : 'none';

            // Update buttons
            prevBtn.style.display = currentStep > 1 ? 'inline-flex' : 'none';
            nextBtn.style.display = currentStep < 2 ? 'inline-flex' : 'none';
            createBtn.style.display = currentStep === 2 ? 'block' : 'none';
            copyBtn.style.display = currentStep === 3 ? 'inline-flex' : 'none';
            shareBtn.style.display = currentStep === 3 ? 'inline-flex' : 'none';
        }

        function nextStep() {
            if (currentStep === 1) {
                const sourceUrl = document.getElementById('sourceUrl').value;
                if (!sourceUrl) {
                    alert('Veuillez saisir une URL source');
                    return;
                }
                if (!fetchedMetadata) {
                    alert('Veuillez d\'abord r√©cup√©rer les informations');
                    return;
                }
            }

            if (currentStep < 3) {
                currentStep++;
                updateSteps();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        }

        async function fetchMetadata() {
            const sourceUrl = document.getElementById('sourceUrl').value;
            if (!sourceUrl) {
                alert('Veuillez saisir une URL');
                return;
            }

            const button = event.target;
            button.innerHTML = '<span>‚è≥</span> R√©cup√©ration en cours...';
            button.disabled = true;

            try {
                // Appel au proxy local pour √©viter CORS
                const proxyUrl = `/api/proxy/fetch-metadata?url=${encodeURIComponent(sourceUrl)}`;
                
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error('Erreur lors de la r√©cup√©ration des m√©tadonn√©es');
                }

                const backendResponse = await response.json();
                
                if (backendResponse.success && backendResponse.data) {
                    const odesliData = backendResponse.data;
                    
                    if (odesliData && odesliData.linksByPlatform) {
                        // Extraire les m√©tadonn√©es depuis Odesli
                        const metadata = extractMetadataFromOdesli(odesliData);
                        
                        // Extraire les liens des plateformes
                        const platformLinks = extractPlatformLinksFromOdesli(odesliData);
                    
                    // Stocker les donn√©es r√©cup√©r√©es
                    fetchedMetadata = {
                        title: metadata.title,
                        artist: metadata.artist,
                        artwork: metadata.artwork,
                        platforms: platformLinks
                    };
                    
                    // Remplir automatiquement les champs
                    if (metadata.title) {
                        document.getElementById('smartlinkTitle').value = metadata.title;
                    }
                    if (metadata.artist) {
                        document.getElementById('artistName').value = metadata.artist;
                    }
                    if (metadata.artwork) {
                        document.getElementById('artworkUrl').value = metadata.artwork;
                    }
                    
                        // Afficher la pr√©visualisation des donn√©es
                        displayMetadataPreview(metadata, platformLinks);
                        
                        // Afficher les plateformes trouv√©es
                        displayPlatformsFound(platformLinks);
                        
                        button.innerHTML = `<span>‚úÖ</span> ${platformLinks.length} plateformes trouv√©es`;
                        button.style.background = '#10b981';
                        
                        // Auto-passer √† l'√©tape suivante apr√®s 1.5s
                        setTimeout(() => {
                            nextStep();
                        }, 1500);
                    } else {
                        throw new Error('Aucune donn√©e trouv√©e pour cette URL');
                    }
                } else {
                    throw new Error(backendResponse.error || 'Erreur backend');
                }
            } catch (error) {
                console.error('Erreur Odesli:', error);
                
                button.innerHTML = '<span>‚ùå</span> Erreur lors de la r√©cup√©ration';
                button.style.background = '#dc2626';
                button.disabled = false;
                
                // Afficher l'erreur √† l'utilisateur
                alert(`Impossible de r√©cup√©rer les m√©tadonn√©es: ${error.message}\n\nV√©rifiez que l'URL est valide et r√©essayez.`);
            }
        }

        // Fonction pour extraire les m√©tadonn√©es depuis Odesli
        function extractMetadataFromOdesli(odesliData) {
            const entities = odesliData.entitiesByUniqueId;
            if (!entities) return { title: '', artist: '', artwork: '' };

            // Trouver la premi√®re entit√© qui contient les m√©tadonn√©es
            const entity = Object.values(entities).find(e => e.title && e.artistName);
            
            return {
                title: entity?.title || '',
                artist: entity?.artistName || '',
                artwork: entity?.thumbnailUrl || entity?.imageUrl || ''
            };
        }

        // Fonction pour extraire les liens des plateformes depuis Odesli
        function extractPlatformLinksFromOdesli(odesliData) {
            const linksByPlatform = odesliData.linksByPlatform;
            if (!linksByPlatform) return [];

            const platformMapping = {
                'spotify': 'Spotify',
                'appleMusic': 'Apple Music',
                'deezer': 'Deezer',
                'youtube': 'YouTube',
                'youtubeMusic': 'YouTube Music',
                'soundcloud': 'SoundCloud',
                'tidal': 'Tidal',
                'amazonMusic': 'Amazon Music',
                'pandora': 'Pandora',
                'napster': 'Napster',
                'yandex': 'Yandex Music'
            };

            const links = [];
            
            Object.entries(linksByPlatform).forEach(([platform, data]) => {
                if (data && data.url) {
                    links.push({
                        platform: platformMapping[platform] || platform,
                        url: data.url
                    });
                }
            });

            return links;
        }

        // Afficher la pr√©visualisation des m√©tadonn√©es
        function displayMetadataPreview(metadata, platforms) {
            const preview = document.getElementById('metadataPreview');
            const previewArtwork = document.getElementById('previewArtwork');
            const previewTitle = document.getElementById('previewTitle');
            const previewArtist = document.getElementById('previewArtist');
            const previewPlatforms = document.getElementById('previewPlatforms');
            
            // Remplir les donn√©es
            previewTitle.textContent = metadata.title || 'Titre non disponible';
            previewArtist.textContent = metadata.artist || 'Artiste non disponible';
            previewPlatforms.textContent = `${platforms.length} plateformes d√©tect√©es: ${platforms.map(p => p.platform).slice(0, 3).join(', ')}${platforms.length > 3 ? '...' : ''}`;
            
            // G√©rer l'artwork
            if (metadata.artwork) {
                previewArtwork.src = metadata.artwork;
                previewArtwork.style.display = 'block';
                previewArtwork.onerror = function() {
                    this.style.display = 'none';
                };
            } else {
                previewArtwork.style.display = 'none';
            }
            
            // Afficher la pr√©visualisation
            preview.style.display = 'block';
            
            // Animation d'apparition
            preview.style.opacity = '0';
            preview.style.transform = 'translateY(20px)';
            setTimeout(() => {
                preview.style.transition = 'all 0.5s ease';
                preview.style.opacity = '1';
                preview.style.transform = 'translateY(0)';
            }, 100);
        }

        // Afficher visuellement les plateformes trouv√©es
        function displayPlatformsFound(platforms) {
            const platformItems = document.querySelectorAll('.platform-item');
            const foundPlatforms = platforms.map(p => p.platform.toLowerCase());
            
            platformItems.forEach(item => {
                const platformName = item.querySelector('.platform-name').textContent.toLowerCase();
                const isFound = foundPlatforms.some(found => 
                    found.includes(platformName) || platformName.includes(found.split(' ')[0])
                );
                
                if (isFound) {
                    item.style.borderColor = '#10b981';
                    item.style.background = 'rgba(16, 185, 129, 0.1)';
                    item.style.transform = 'scale(1.02)';
                    
                    // Ajouter un badge "trouv√©"
                    if (!item.querySelector('.found-badge')) {
                        const badge = document.createElement('div');
                        badge.className = 'found-badge';
                        badge.innerHTML = '‚úÖ';
                        badge.style.cssText = 'position: absolute; top: -5px; right: -5px; background: #10b981; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 10px;';
                        item.style.position = 'relative';
                        item.appendChild(badge);
                    }
                } else {
                    item.style.opacity = '0.6';
                    item.style.transform = 'scale(0.98)';
                }
            });
        }

        async function createSmartLink() {
            if (!fetchedMetadata) {
                alert('Veuillez d\'abord r√©cup√©rer les m√©tadonn√©es avec une URL');
                return;
            }

            const title = document.getElementById('smartlinkTitle').value;
            const artistName = document.getElementById('artistName').value;
            const customSlug = document.getElementById('customSlug').value;
            const artworkUrl = document.getElementById('artworkUrl').value;
            
            if (!title || !artistName) {
                alert('Veuillez remplir au moins le titre et l\'artiste');
                return;
            }
            
            const button = document.getElementById('createBtn');
            button.innerHTML = '<span>‚è≥</span> Cr√©ation en cours...';
            button.disabled = true;

            try {
                // Pr√©parer les donn√©es pour le backend
                const smartLinkData = {
                    trackTitle: title,
                    artistName: artistName,
                    slug: customSlug || title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, ''),
                    coverImageUrl: artworkUrl,
                    platformLinks: fetchedMetadata.platforms || {},
                    description: `Listen to ${title} by ${artistName} on your favorite platform`,
                    isPublished: true
                };

                // R√©cup√©rer le token admin du localStorage (d√©fini au niveau /admin)
                const adminToken = localStorage.getItem('adminToken');
                
                if (!adminToken) {
                    throw new Error('Token administrateur manquant. Veuillez vous reconnecter via /admin');
                }

                // Appel au proxy local pour √©viter CORS
                const response = await fetch('/api/proxy/create-smartlink', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`,
                        'X-Admin-Token': adminToken,
                    },
                    body: JSON.stringify(smartLinkData)
                });

                if (!response.ok) {
                    let errorMessage = `Erreur API ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        // Keep default error message
                    }
                    
                    if (response.status === 401) {
                        errorMessage = 'Authentification requise. Veuillez vous connecter en tant qu\'administrateur.';
                    } else if (response.status === 403) {
                        errorMessage = 'Acc√®s refus√©. Permissions insuffisantes.';
                    }
                    
                    throw new Error(errorMessage);
                }

                const result = await response.json();
                
                if (result.success) {
                    // SmartLink cr√©√© avec succ√®s - utiliser le format frontend React
                    const artistSlug = result.data.artistSlug || result.data.artist?.slug || 'artist';
                    const trackSlug = result.data.slug || result.data.trackSlug || 'track';
                    
                    // Utiliser l'URL retourn√©e par le backend (fichier HTML statique)
                    const generatedUrl = result.data.url || result.data.smartlink?.url || `https://www.mdmcmusicads.com/sl/${result.data.shortId || result.data.id}.html`;
                    
                    console.log('‚úÖ SmartLink g√©n√©r√©:', generatedUrl);
                    console.log('üìä Donn√©es re√ßues:', result.data);
                    console.log('üîó URL finale:', generatedUrl);
                    
                    const urlElement = document.getElementById('generatedUrl');
                    console.log('üîç URL Element found:', !!urlElement);
                    if (urlElement) {
                        urlElement.textContent = generatedUrl;
                        console.log('‚úÖ URL set to element:', generatedUrl);
                    } else {
                        console.error('‚ùå Element generatedUrl not found!');
                    }
                    
                    // G√©n√©rer automatiquement la page HTML statique
                    try {
                        console.log('üî® G√©n√©ration HTML statique...');
                        console.log('üìä Donn√©es envoy√©es pour g√©n√©ration:', {
                            trackTitle: result.data.trackTitle || result.data.title || result.data.name || 'Track',
                            artistName: result.data.artistName || result.data.artist?.name || result.data.artist || 'Artist', 
                            coverImageUrl: result.data.coverImageUrl || result.data.artwork || result.data.cover || result.data.image,
                            shortId: result.data.shortId || result.data.id || result.data._id || result.data.slug,
                            customDescription: result.data.description || result.data.customDescription,
                            platformLinks: result.data.platformLinks || result.data.platforms || result.data.links || []
                        });
                        
                        const htmlResponse = await fetch('/api/generate/smartlink-html', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                trackTitle: result.data.trackTitle || result.data.title || result.data.name || 'Track',
                                artistName: result.data.artistName || result.data.artist?.name || result.data.artist || 'Artist', 
                                coverImageUrl: result.data.coverImageUrl || result.data.artwork || result.data.cover || result.data.image,
                                shortId: result.data.shortId || result.data.id || result.data._id || result.data.slug,
                                customDescription: result.data.description || result.data.customDescription,
                                platformLinks: result.data.platformLinks || result.data.platforms || result.data.links || []
                            })
                        });
                        
                        console.log('üì° HTML Response status:', htmlResponse.status);
                        const htmlResult = await htmlResponse.json();
                        console.log('üìÑ HTML Response data:', htmlResult);
                        
                        if (htmlResult.success) {
                            console.log('‚úÖ Page HTML statique g√©n√©r√©e:', htmlResult.url);
                            // Utiliser l'URL statique g√©n√©r√©e au lieu de l'URL React
                            const finalUrl = htmlResult.url;
                            document.getElementById('generatedUrl').textContent = finalUrl;
                            console.log('üîó URL finale mise √† jour:', finalUrl);
                        } else {
                            console.error('‚ùå Erreur g√©n√©ration HTML:', htmlResult.error, htmlResult.details);
                            alert('‚ö†Ô∏è Erreur g√©n√©ration page HTML: ' + htmlResult.error);
                            // Afficher l'URL par d√©faut quand m√™me
                            console.log('üìç Using fallback URL:', generatedUrl);
                        }
                        
                    } catch (htmlError) {
                        console.error('‚ùå Exception g√©n√©ration HTML statique:', htmlError);
                        alert('‚ö†Ô∏è Exception HTML generation: ' + htmlError.message);
                        // Afficher l'URL par d√©faut quand m√™me
                        console.log('üìç Using fallback URL after exception:', generatedUrl);
                    }
                    
                    currentStep = 3;
                    updateSteps();
                    
                    // Scroll to result
                    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                    
                    // Optionnel: afficher l'ID du SmartLink cr√©√©
                    console.log('SmartLink cr√©√©:', result.data);
                } else {
                    throw new Error(result.message || 'Erreur lors de la cr√©ation');
                }

            } catch (error) {
                console.error('Erreur cr√©ation SmartLink:', error);
                alert(`Erreur lors de la cr√©ation: ${error.message}`);
                
                // R√©initialiser le bouton
                button.innerHTML = '<span>üöÄ</span> Cr√©er le SmartLink';
                button.disabled = false;
            }
        }

        function copyToClipboard() {
            const url = document.getElementById('generatedUrl').textContent;
            navigator.clipboard.writeText(url).then(() => {
                const button = document.getElementById('copyBtn');
                const originalText = button.innerHTML;
                button.innerHTML = '<span>‚úÖ</span> Copi√© !';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            });
        }

        function shareSmartLink() {
            const url = document.getElementById('generatedUrl').textContent;
            const title = document.getElementById('smartlinkTitle').value;
            
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                });
            } else {
                // Fallback - copy to clipboard
                copyToClipboard();
            }
        }

        function goBack() {
            // Navigate back to dashboard
            window.history.back();
        }

        // Initialize
        updateSteps();
        setupAudioUpload();

        // Auto-save form data
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('input', () => {
                localStorage.setItem('smartlink_' + input.id, input.value);
            });
        });

        // Restore form data
        document.querySelectorAll('.form-input').forEach(input => {
            const saved = localStorage.getItem('smartlink_' + input.id);
            if (saved) {
                input.value = saved;
            }
        });

        // Enter key navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                if (currentStep === 1 && document.getElementById('sourceUrl').value) {
                    fetchMetadata();
                } else if (currentStep === 2) {
                    createSmartLink();
                }
            }
        });

        // Variables globales pour l'upload audio
        let uploadedAudioData = null;

        // Gestion de l'upload d'extrait audio
        function setupAudioUpload() {
            const audioInput = document.getElementById('audioFile');
            const uploadZone = document.getElementById('uploadZone');
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadSuccess = document.getElementById('uploadSuccess');
            const removeAudioBtn = document.getElementById('removeAudio');
            const previewUrlInput = document.getElementById('previewUrl');

            // Click sur la zone d'upload
            uploadZone.addEventListener('click', () => {
                audioInput.click();
            });

            // Drag & Drop events
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('audio/')) {
                        audioInput.files = files;
                        handleAudioUpload(file);
                    } else {
                        alert('Veuillez s√©lectionner un fichier audio valide');
                    }
                }
            });

            // Changement de fichier
            audioInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleAudioUpload(file);
                }
            });

            // Suppression du fichier
            removeAudioBtn.addEventListener('click', () => {
                removeAudioFile();
            });
        }

        // G√©rer l'upload du fichier audio
        async function handleAudioUpload(file) {
            // Validation
            if (!file.type.startsWith('audio/')) {
                alert('Seuls les fichiers audio sont autoris√©s');
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB
                alert('Le fichier ne doit pas d√©passer 10MB');
                return;
            }

            // Afficher la progression
            showUploadProgress();

            try {
                const formData = new FormData();
                formData.append('audio', file);

                // Upload avec suivi de progression et timeout
                const xhr = new XMLHttpRequest();
                
                // Timeout apr√®s 30 secondes
                const uploadTimeout = setTimeout(() => {
                    xhr.abort();
                    console.error('Upload timeout apr√®s 30 secondes');
                    handleUploadError('Timeout: L\'upload a pris trop de temps. V√©rifiez la taille du fichier.');
                }, 30000);
                
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        updateProgress(percentComplete);
                    }
                });

                xhr.addEventListener('load', () => {
                    clearTimeout(uploadTimeout);
                    
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                uploadedAudioData = response.data;
                                showUploadSuccess(response.data);
                                
                                // Remplir le champ cach√© avec l'URL
                                document.getElementById('previewUrl').value = response.data.url;
                                
                                console.log('‚úÖ Extrait audio upload√© avec succ√®s!');
                            } else {
                                throw new Error(response.error || 'Erreur upload');
                            }
                        } catch (parseError) {
                            console.error('Erreur parsing r√©ponse:', parseError);
                            handleUploadError('R√©ponse serveur invalide');
                        }
                    } else if (xhr.status === 404) {
                        handleUploadError('API d\'upload non disponible (404). Continuez sans extrait audio.');
                    } else {
                        handleUploadError(`Erreur serveur ${xhr.status}: ${xhr.statusText}`);
                    }
                });

                xhr.addEventListener('error', () => {
                    clearTimeout(uploadTimeout);
                    handleUploadError('Erreur r√©seau. V√©rifiez votre connexion.');
                });

                xhr.addEventListener('abort', () => {
                    clearTimeout(uploadTimeout);
                    handleUploadError('Upload annul√©');
                });

                xhr.open('POST', '/api/upload/audio');
                
                // Ajouter le token d'authentification
                const adminToken = localStorage.getItem('adminToken');
                if (adminToken) {
                    xhr.setRequestHeader('Authorization', `Bearer ${adminToken}`);
                    xhr.setRequestHeader('X-Admin-Token', adminToken);
                }
                
                xhr.send(formData);

            } catch (error) {
                console.error('Erreur upload:', error);
                handleUploadError(`Erreur upload: ${error.message}`);
            }
        }

        // G√©rer les erreurs d'upload de fa√ßon plus user-friendly
        function handleUploadError(errorMessage) {
            console.error('Erreur upload audio:', errorMessage);
            
            // Proposer de continuer sans extrait audio
            const continueWithoutAudio = confirm(
                `‚ùå Erreur d'upload audio: ${errorMessage}\n\n` +
                `Voulez-vous continuer sans extrait audio ?\n\n` +
                `‚Ä¢ OUI = Continuer la cr√©ation du SmartLink sans audio\n` +
                `‚Ä¢ ANNULER = R√©essayer l'upload`
            );
            
            if (continueWithoutAudio) {
                // Simuler un succ√®s sans fichier
                showUploadSuccess({
                    originalName: 'Aucun extrait audio',
                    size: 0
                });
                document.getElementById('previewUrl').value = '';
                
                // Changer le style pour indiquer "pas d'audio"
                const successDiv = document.getElementById('uploadSuccess');
                successDiv.style.background = 'rgba(245, 158, 11, 0.1)';
                const successText = document.getElementById('successText');
                successText.textContent = 'Pas d\'extrait audio - SmartLink sans preview';
                successText.style.color = '#f59e0b';
                
                // Masquer le bouton de suppression
                document.getElementById('removeAudio').style.display = 'none';
            } else {
                // Remettre √† z√©ro pour permettre un nouvel essai
                resetUploadState();
            }
        }

        // Afficher la progression
        function showUploadProgress() {
            document.getElementById('uploadZone').style.display = 'none';
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('uploadSuccess').style.display = 'none';
        }

        // Mettre √† jour la barre de progression
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `Upload en cours... ${Math.round(percentage)}%`;
        }

        // Afficher le succ√®s de l'upload
        function showUploadSuccess(audioData) {
            document.getElementById('uploadZone').style.display = 'none';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'block';
            
            const successText = document.getElementById('successText');
            successText.textContent = `${audioData.originalName} (${formatFileSize(audioData.size)})`;
        }

        // Supprimer le fichier audio
        async function removeAudioFile() {
            if (!uploadedAudioData) return;

            try {
                // Ajouter le token d'authentification pour la suppression
                const adminToken = localStorage.getItem('adminToken');
                const headers = {};
                if (adminToken) {
                    headers['Authorization'] = `Bearer ${adminToken}`;
                    headers['X-Admin-Token'] = adminToken;
                }
                
                const response = await fetch(`/api/upload/audio/${uploadedAudioData.filename}`, {
                    method: 'DELETE',
                    headers: headers
                });

                if (response.ok) {
                    resetUploadState();
                    document.getElementById('previewUrl').value = '';
                    uploadedAudioData = null;
                    console.log('Fichier audio supprim√©');
                } else {
                    throw new Error('Erreur suppression fichier');
                }
            } catch (error) {
                console.error('Erreur suppression:', error);
                alert('Erreur lors de la suppression');
            }
        }

        // Remettre √† z√©ro l'√©tat de l'upload
        function resetUploadState() {
            document.getElementById('uploadZone').style.display = 'block';
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'none';
            document.getElementById('audioFile').value = '';
        }

        // Formater la taille du fichier
        function formatFileSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 Byte';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }
    </script>
</body>
</html>